---
title: 网络拥塞控制
date: 2018-03-11 16:30:30
tags: [计算机网络]
---

# 网络拥塞控制

网络中的链接数量非常巨大且繁杂，建立在这些链接上的数据传输变得更加复杂。和生活中的运输系统一样，网络中也会出现拥堵，拥塞控制协议一定程度上决定着网络的稳定性。如何最大程度的避免拥塞的出现、拥塞出现后应该如何进行恢复这些问题都是拥塞控制中的重中之重。

## 拥塞控制的类型

- 基于窗口的拥塞控制 CWnd
- 基于速率的拥塞控制


## 相关的几个拥塞控制协议

### TCP-Tahoe

#### Nutshell中的TCP Tahoe

以下是该协议中的几个概念

- 拥塞控制窗口
- 拥塞控制机制
    + 慢启动
    + 超时
    + 拥塞避免
    + 快速重传
 
- 拥塞信号
    + 重传超时或者
    + 重复接收
    -> 开始慢启动
     
- 参数
    + 拥塞窗口 CWnd
    + 阈值 SSThres
        * 从慢启动到拥塞避免的拥塞窗口的大小
 
- 预备知识
    + AIMD(和式增加，积式减少)
        * 接收到回复加法递增CWnd
        * 预计丢包乘法减少
- 初始化
    + CWnd = 1 MSS
    + SSHThres 无穷
    + 重复回复数：3

**快速重传**

并非所有队列中获得的数据都是网络超载的标志，比如单个数据的丢失但是数据传输是不存在问题的。

这个时候就需要等待时间到期（超时），然后重新发送，等待的时间大于往返时延RRT。

快速重传的目的是为了达到更快的响应，在收到多次重复回复（大于初始化时定义的数）后重发。相较等待超时明显更加快速

**协议流程**

- 慢启动阶段：如果拥塞窗口小于阈值并且收到回复确认
    + 指数级别增长
- 拥塞避免阶段：拥塞窗口大于设定阈值并且接收到回复确认
    + 线性增长 
- 再次进入慢启动阶段：超时或者3次重复确认
    + 拥塞状况估计
    + SSHThresh = max(FlightSize/2, 2*MSS)
        * FlightSize: 已经发送但是未接受到回复确认的数据大小
    + CWnd = 1 MSS
    + 如果3次重复回复确认：重发这部分数据

### 分析和改进

#### 流控自同步

TCP使用的是基于窗口的流控制

基本的设定

- 完整的流控窗口用于中转
- 到达接收方的使用低速率的瓶颈链路

![TCP窗口流控](http://7xonju.com1.z0.glb.clouddn.com/image/kurs/TCP%E7%AA%97%E5%8F%A3%E6%B5%81%E6%8E%A7.PNG)

最慢转发部分（最窄的通道）的容量决定了发送方发送下一个包的时间间隔。

#### 慢启动

为了实现TCP的连接平衡，在新建立一个连接和状态估计后。

基本的观点（每一个TCP连接），不马上发送完整的流控制窗口，梯度增加帧的大小。

#### 和式增加，积式减少

回传控制算法

![TCP Tahoe](http://7xonju.com1.z0.glb.clouddn.com/image/kurs/Taheo.PNG)

### TCP-Reno

拥塞情况分为由于超时的未达回复确认(严重的拥塞)和接受重复回复确认（轻度拥塞）。

#### 快速恢复

与TCP Tahoe不同的是在经过由于3次重复回复确认导致的快速重传后，还需要对对阈值和拥塞窗口做调整，使得最后能够快速达到高速的传输，而并非直接完全重新进行一次慢启动。对拥塞情况作了分级，超时严重拥塞慢启动，重复回复确认轻度拥塞快速恢复。

**流程**

- 超时（严重的拥塞）：慢启动
- 3次重复回复确认（轻度拥塞）：快速恢复
    + 重传帧（快速重传）
    + SSThresh = max(FlightSiz/2, 2*MSS)
    + CWnd = SSThresh + 3MSS
![Reno](http://7xonju.com1.z0.glb.clouddn.com/image/kurs/Reno.PNG)
![](http://7xonju.com1.z0.glb.clouddn.com/image/logo/mainlogo.png)